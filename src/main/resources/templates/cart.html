<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Shopping Cart</title>
</head>
<body>
<h1>Your Cart</h1>

<table border="1">
    <thead>
    <tr>
        <th>Product</th>
        <th>Price</th>
        <th>Quantity</th>
        <th>Subtotal</th>
    </tr>
    </thead>
    <tbody>
    <tr th:each="item : ${cartItems}">
        <td th:text="${item.product.name}"></td>
        <td th:text="${item.product.price}"></td>
        <td th:text="${item.quantity}"></td>
        <td th:text="${item.product.price * item.quantity}"></td>
        <td>
            <button type="button" class="remove-btn" th:data-id="${item.product.id}">Remove</button>
        </td>
    </tr>
    </tbody>
</table>

<div class="logout">
    <button id="logoutBtn" class="btn-logout">Logout</button>
</div>

<script>
    document.getElementById('logoutBtn').addEventListener('click', function () {
        fetch('/api/auth/logout', {
            method: 'POST',
            credentials: 'include'
        })
            .then(response => {
                if (response.ok) {
                    window.location.href = '/index.html';
                } else {
                    return response.text().then(text => { throw new Error(text); });
                }
            })
            .catch(error => {
                alert("Logout failed: " + error.message);
            });
    });

    document.querySelectorAll('.remove-btn').forEach(button => {
        button.addEventListener('click', function () {
            const productId = this.getAttribute('data-id');

            fetch('/api/cart/remove', {
                method: 'DELETE',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ productId: productId }),
                credentials: 'include'
            })
                .then(response => {
                    if (response.ok) {
                        window.location.reload();
                    } else {
                        alert('Failed to remove item');
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                });
        });
    });

</script>

</body>
</html>
